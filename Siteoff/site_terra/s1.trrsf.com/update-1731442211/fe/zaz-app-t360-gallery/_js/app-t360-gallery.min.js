/*! zaz-app-t360-gallery - v1.0.0 - 05/02/2024 -- 1:48pm */

zaz.use(function appT360Gallery(pkg){"use strict";var console=pkg.console,appFactory,STATIC_PUBLIC={},STATIC_PRIVATE={};pkg.factoryManager.get("app").create({name:"t360.gallery",version:"1.0.0",state:"ok",docs:"http://github.tpn.terra.com/pages/terra/t360-gallery",source:"http://github.tpn.terra.com/Terra/t360-gallery",description:"Just another app",tests:"http://s1.trrsf.com/fe/t360-gallery/tests/index.htm?zaz[env]=tests",dependencies:["mod.manager"],dictionaries:[],templates:{gallery:'<div class="t360-gallery__container t360-gallery__container__main"><div class="t360-gallery__container__main--spinner"></div><div class="t360-gallery__container__main--carousel"><div class="t360-gallery__container__main--carousel--arrow_wrapper t360-gallery__container__main--carousel--arrow-left"><span class="t360-gallery__container__main--carousel--arrow_wrapper--arrow icon icon-solid icon-chevron-left"></span></div><ul class="t360-gallery__container__main--carousel--slider" data-count="1">{% for image in data.images %}{% if loop.index != 1 and loop.index % 5 - 1 == 0 %}<li class="t360-gallery__container__main--carousel--slider--item t360-gallery__container__main--carousel--slider--ad"><div class="card card-ad card-ad-auto"><span class="card-ad__title">Publicidade</span><div class="card-ad__content" id="ad-gallery-{{ galleryId }}-{{ (loop.index -1) // 5}}"></div></div></li>{% endif %}{% if image.author %}{% set imageName = image.author %}{% else %}{% set imageName = image.source.publicName %}{% endif %}<li class="t360-gallery__container__main--carousel--slider--item" data-id="{{ image.id }}"><span class="t360-gallery__container__main--carousel--slider--item--image item-img" style="background-image:url(\'https://p2.trrsf.com/image/fget/cf/fit-in/648/364/{{ image.url.replace(\'http://\', \'\') }}\')"></span><div class="t360-gallery__container__main--carousel--slider--item--info"><div class="t360-gallery__container__main--carousel--slider--item--info__caption">{{ image.caption | safe}}</div><span class="t360-gallery__container__main--carousel--slider--item--info--font">{% if imageName %}Foto: {{ imageName.replace(\'Foto:\', \'\') }}{% endif %}</span></div></li>{% endfor %}</ul><div class="t360-gallery__container__main--carousel--arrow_wrapper t360-gallery__container__main--carousel--arrow-right"><span class="t360-gallery__container__main--carousel--arrow_wrapper--arrow icon icon-solid icon-chevron-right"></span></div></div><div class="t360-gallery__container__main--expand t360-gallery__container__main--side-icon"><span class="icon icon-solid icon-16 icon-expand-arrows-alt"></span></div><div class="t360-gallery__container__main--share t360-gallery__container__main--side-icon"><div class="t360-gallery--sharebar__wrapper"><div class="t360-gallery--sharebar">Compartilhar<span class="icon icon-solid icon-16 icon-share"></span></div></div></div></div><div class="t360-gallery__advertisement"><div class="card card-ad card-ad-auto"><span class="card-ad__title">Publicidade</span><div class="card-ad__content" id="ad-gallery-{{ galleryId }}"></div></div></div>'},expects:{properties:{id:{type:"string",required:!0}}},setup:function(STATIC_PUBLIC,PUBLIC,__shared){__shared.taboolaPubliCount=0},init:function(data,__shared){var PRIVATE={},PUBLIC=this;return PRIVATE.elements={},PRIVATE.amount=0,PRIVATE.url=new URL(window.location),PRIVATE.intergalleryAdLoaded=[],PRIVATE.canonicalUrl=new URL(pkg.context.page.get("canonical_url")),"mob"===pkg.context.platform.get("type")?(PRIVATE.widths={listLimit:2,widThumb:88,heigThumb:60,widImage:280,heigImage:230},PRIVATE.encoder=function(x){return x}):(PRIVATE.widths={listLimit:4,widThumb:124,heigThumb:80,widImage:648,heigImage:403},PRIVATE.encoder=encodeURIComponent),""!=window.location.search&&PRIVATE.url.searchParams.get("galleryId")==data.id&&(PRIVATE.fullscreenAt=PRIVATE.url.searchParams.get("galleryPosition")),PRIVATE.getGalleryFeed=function(){var feedOrigin=window.location.hostname.search(/hlg|ap09/gi)<0?"https://syndication.terra.com":"https://hlg-cms-delivery01-mia.dev.terra.com",requestUrl=window.location.hostname.search(/hlg|ap09/gi)<0?"36f0505a-d826-4b00-bde7-930447b37579":"f6f251ac-17b4-49d0-9946-dde72b57833b",requestUrl=feedOrigin+"/feeder/galleries/gallery/"+PRIVATE.id+".json?site=Brasil&access_token="+requestUrl;fetch(requestUrl).then(function(response){return response.json()}).then(function(data){PRIVATE.jsonFeed=data,PRIVATE.renderHTML()})},PRIVATE.renderHTML=function(){var galleryFragment=PUBLIC.templates.render("gallery",{galleryId:PRIVATE.id,data:PRIVATE.jsonFeed,widths:PRIVATE.widths}),oldGallery=document.querySelector("#gallery-starter-"+PRIVATE.id+":not([data-events])");oldGallery.innerHTML="",oldGallery.appendChild(galleryFragment,oldGallery),oldGallery.htmlDataset("started",!0),PRIVATE.elements.container=oldGallery,PRIVATE.setUpEvents()},PRIVATE.recalculateCount=function(galleryContainer){var page=galleryContainer.scrollLeft/galleryContainer.offsetWidth+1;galleryContainer.setAttribute("data-count",page)},PRIVATE.fullscreenToggle=function(event,fullscreenAt){PRIVATE.recalculateCount(PRIVATE.galleryContainer),PRIVATE.elements.container.querySelector(".t360-gallery__container__main--carousel--slider").style.scrollBehavior="unset",0==PRIVATE.amount&&(PRIVATE.amount=PRIVATE.galleryContainer.offsetWidth);var icon=PRIVATE.elements.container.querySelector(".t360-gallery__container__main--expand .icon");if(PRIVATE.elements.container.classList.contains("fullscreen"))PRIVATE.url.searchParams.delete("galleryId"),PRIVATE.url.searchParams.delete("galleryPosition"),window.history.replaceState({},"",PRIVATE.url),PRIVATE.elements.container.classList.remove("fullscreen"),icon.classList.remove("icon-times"),icon.classList.add("icon-expand-arrows-alt"),document.querySelector("body").style.overflow="",PRIVATE.galleryContainer.style.minWidth="",PRIVATE.galleryContainer.style.width="",PRIVATE.galleryContainer.style.height="",Array.prototype.forEach.call(PRIVATE.galleryContainer.querySelectorAll(".t360-gallery__container__main--carousel--slider--item"),function(node){node.style.minWidth="",node.style.width="",node.style.height=""}),Array.prototype.forEach.call(PRIVATE.galleryContainer.querySelectorAll(".t360-gallery__container__main--carousel--slider--item--image"),function(node){node.style.minWidth="",node.style.width="",node.style.height="",node.style.backgroundImage=node.style.backgroundImage.replace("/1200/0/filters:quality(100)/","/648/364/")}),PRIVATE.elements.container.querySelector(".t360-gallery__advertisement").style.display="none",PRIVATE.carouselPrincipal.stepToItem(PRIVATE.amount,"min");else{window.tga.send("send","event","gallery","click","fullscreen"),fullscreenAt&&(1<fullscreenAt&&fullscreenAt%5==1&&--fullscreenAt,PRIVATE.galleryContainer.dataset.count=fullscreenAt),PRIVATE.url.searchParams.set("galleryId",PRIVATE.id),PRIVATE.url.searchParams.set("galleryPosition",PRIVATE.galleryContainer.dataset.count),window.history.replaceState({},"",PRIVATE.url);try{PRIVATE.canonicalUrl.searchParams.set("galleryId",PRIVATE.id),PRIVATE.canonicalUrl.searchParams.set("galleryPosition",PRIVATE.galleryContainer.dataset.count),PRIVATE.sharebar.updateUrl(PRIVATE.encoder(PRIVATE.canonicalUrl.href))}catch(e){}PRIVATE.elements.container.classList.add("fullscreen"),icon.classList.remove("icon-expand-arrows-alt"),icon.classList.add("icon-times"),PRIVATE.galleryContainer.style.minWidth=PRIVATE.width,PRIVATE.galleryContainer.style.width=PRIVATE.width,PRIVATE.galleryContainer.style.height=PRIVATE.sliderHeight,PRIVATE.elements.container.querySelector(".t360-gallery__advertisement").style.display=PRIVATE.advertisement,document.querySelector("body").style.overflow="hidden",Array.prototype.forEach.call(PRIVATE.galleryContainer.querySelectorAll(".t360-gallery__container__main--carousel--slider--item"),function(node){node.style.minWidth=PRIVATE.width,node.style.width=PRIVATE.width,node.style.height="100%"}),Array.prototype.forEach.call(PRIVATE.galleryContainer.querySelectorAll(".t360-gallery__container__main--carousel--slider--item--image"),function(node){node.style.width="100%",node.style.height="calc(100% - 60px)",node.style.objectFit="contain",node.style.backgroundImage=node.style.backgroundImage.replace("/648/364/","/1200/0/filters:quality(100)/")}),PRIVATE.carouselPrincipal.stepToItem(PRIVATE.galleryContainer.offsetWidth,"max"),"mob"!==pkg.context.platform.get("type")&&(PRIVATE.admanager||(PRIVATE.admanager=new __shared.dependencies.mod.adManager),PRIVATE.admanager.stickAd({placeholder:PRIVATE.elements.container.querySelector("#ad-gallery-"+PRIVATE.id),area:"galeria",tgmkey:window.tgmKey}))}PRIVATE.elements.container.querySelector(".t360-gallery__container__main--carousel--slider").style.scrollBehavior=""},PRIVATE.putAdAt=function(position){var adLocation;PRIVATE.intergalleryAdLoaded[position]||(PRIVATE.intergalleryAdLoaded[position]=!0,PRIVATE.elements.container.querySelector("#ad-gallery-"+PRIVATE.id+"-"+position)&&(PRIVATE.admanager||(PRIVATE.admanager=new __shared.dependencies.mod.adManager),PRIVATE.admanager.stickAd({placeholder:PRIVATE.elements.container.querySelector("#ad-gallery-"+PRIVATE.id+"-"+position),area:"galeria",tgmkey:window.tgmKey})))},PRIVATE.setUpEvents=function(){PRIVATE.galleryContainer=PRIVATE.elements.container.querySelector(".t360-gallery__container__main--carousel--slider");var expandGalleryButton=PRIVATE.elements.container.querySelector(".t360-gallery__container__main--expand");PRIVATE.elements.btPrev=PRIVATE.elements.container.querySelector(".t360-gallery__container__main--carousel--arrow-left"),PRIVATE.elements.btNext=PRIVATE.elements.container.querySelector(".t360-gallery__container__main--carousel--arrow-right");var galleryPosition=1;if(PRIVATE.loadTaboola(),PRIVATE.elements.container.htmlDataset("events",!0),pkg.context.page.at("range",function(range){"xlarge"===range?(PRIVATE.width="calc(100vw - 400px)",PRIVATE.sliderHeight="100vh",PRIVATE.advertisement="flex"):(PRIVATE.width="100vw",PRIVATE.sliderHeight="100vh",PRIVATE.advertisement="none")}),pkg.require(["mod.t360.carouselRanges"],function(T360CarouselRanges){PRIVATE.carouselPrincipal=new T360CarouselRanges({autoCountItems:!0,countItemsSelector:"."+PRIVATE.randomClass+"#gallery-starter-"+PRIVATE.id+" .t360-gallery__container__main--carousel--slider",containerCarousel:"."+PRIVATE.randomClass+"#gallery-starter-"+PRIVATE.id+" .t360-gallery__container__main--carousel--slider",itemsCarousel:"."+PRIVATE.randomClass+"#gallery-starter-"+PRIVATE.id+" .t360-gallery__container__main--carousel--slider--item",dividerScrollCarousel:1,previousButtonCarousel:"."+PRIVATE.randomClass+"#gallery-starter-"+PRIVATE.id+" .t360-gallery__container__main--carousel--arrow-left",nextButtonCarousel:"."+PRIVATE.randomClass+"#gallery-starter-"+PRIVATE.id+" .t360-gallery__container__main--carousel--arrow-right"}),PRIVATE.fullscreenAt&&(PRIVATE.fullscreenAt%5<=3&&PRIVATE.putAdAt(Math.floor(PRIVATE.fullscreenAt/5)),2<=PRIVATE.fullscreenAt%5&&PRIVATE.putAdAt(Math.ceil(PRIVATE.fullscreenAt/5)),PRIVATE.fullscreenToggle(void 0,PRIVATE.fullscreenAt))}),PRIVATE.elements.btPrev&&(PRIVATE.elements.btPrev.addEventListener("click",function(position){var position;position.currentTarget.classList.contains("arrow-disable")||(window.tga.send("send","event","gallery","click","prev"),PRIVATE.recalculateCount(PRIVATE.galleryContainer),position=Math.ceil(+PRIVATE.galleryContainer.dataset.count-1),PRIVATE.elements.container.classList.contains("fullscreen")&&(PRIVATE.url.searchParams.set("galleryId",PRIVATE.id),PRIVATE.url.searchParams.set("galleryPosition",position),window.history.replaceState({},"",PRIVATE.url),PRIVATE.canonicalUrl.searchParams.set("galleryId",PRIVATE.id),PRIVATE.canonicalUrl.searchParams.set("galleryPosition",position),PRIVATE.sharebar.updateUrl(PRIVATE.encoder(PRIVATE.canonicalUrl.href))))}),pkg.utils.cheats.create(["LEFT"],function(){PRIVATE.isFullscreen()&&PRIVATE.elements.btPrev.click()})),PRIVATE.elements.btNext&&(PRIVATE.elements.btNext.addEventListener("click",function(position){var position;position.currentTarget.classList.contains("arrow-disable")||(window.tga.send("send","event","gallery","click","next"),PRIVATE.recalculateCount(PRIVATE.galleryContainer),position=Math.ceil(+PRIVATE.galleryContainer.dataset.count+1),PRIVATE.elements.container.classList.contains("fullscreen")&&(PRIVATE.url.searchParams.set("galleryId",PRIVATE.id),PRIVATE.url.searchParams.set("galleryPosition",position),window.history.replaceState({},"",PRIVATE.url),PRIVATE.canonicalUrl.searchParams.set("galleryId",PRIVATE.id),PRIVATE.canonicalUrl.searchParams.set("galleryPosition",position),PRIVATE.sharebar.updateUrl(PRIVATE.encoder(PRIVATE.canonicalUrl.href))))}),pkg.utils.cheats.create(["RIGHT"],function(){PRIVATE.isFullscreen()&&PRIVATE.elements.btNext.click()})),"mob"===pkg.context.platform.get("type")){PRIVATE.scrollWatcher=pkg.utils.make.debounce(function(){PRIVATE.recalculateCount(PRIVATE.galleryContainer),PRIVATE.galleryContainer.dataset.count!=galleryPosition&&(+PRIVATE.galleryContainer.dataset.count<+galleryPosition?window.tga.send("send","event","gallery","click","prev"):window.tga.send("send","event","gallery","click","next"),galleryPosition=PRIVATE.galleryContainer.dataset.count,PRIVATE.elements.container.classList.contains("fullscreen")&&(PRIVATE.url.searchParams.set("galleryId",PRIVATE.id),PRIVATE.url.searchParams.set("galleryPosition",PRIVATE.galleryContainer.dataset.count),window.history.replaceState({},"",PRIVATE.url),PRIVATE.canonicalUrl.searchParams.set("galleryId",PRIVATE.id),PRIVATE.canonicalUrl.searchParams.set("galleryPosition",PRIVATE.galleryContainer.dataset.count),PRIVATE.sharebar.updateUrl(PRIVATE.encoder(PRIVATE.canonicalUrl.href))))}),PRIVATE.galleryContainer.addEventListener("scroll",PRIVATE.scrollWatcher);for(var images=PRIVATE.elements.container.querySelectorAll(".item-img"),i=0;i<images.length;i++)images[i].addEventListener("click",PRIVATE.fullscreenToggle)}else pkg.utils.cheats.create(["ESC"],function(){PRIVATE.isFullscreen()&&PRIVATE.fullscreenToggle()});expandGalleryButton.addEventListener("click",PRIVATE.fullscreenToggle),pkg.require("app.t360.sharebar",function(ShareBar){var shareButton=PRIVATE.elements.container.querySelector(".t360-gallery--sharebar"),queryString=new URLSearchParams;PRIVATE.recalculateCount(PRIVATE.galleryContainer);var position=Math.ceil(+PRIVATE.galleryContainer.dataset.count-1);queryString.set("galleryId",PRIVATE.id),queryString.set("galleryPosition",galleryPosition),PRIVATE.sharebar=new ShareBar({sharebars:[shareButton],sharingURL:PRIVATE.canonicalUrl+"?"+queryString.toString(),metricType:"gallery"})},function(exception){console.error('Exception requiring "mod.t360.sharebar": ',exception)})},PRIVATE.loadTaboola=function(){var elems=PRIVATE.elements.container.querySelectorAll(".t360-gallery_ad");elems&&elems.length&&(window._taboola=window._taboola||[],window._taboola.push({article:"auto"}),elems.forEach(function(tc,i){__shared.taboolaPubliCount++,console.log("TABOOLA PUBLIC : "+__shared.taboolaPubliCount);var placement="Widget "+__shared.taboolaPubliCount+" Photo Gallery Desktop",mode="thumbnails-a-1x1-d";"mob"==pkg.context.platform.get("type")&&(placement="Widget "+__shared.taboolaPubliCount+" Photo Gallery Mobile",mode="thumbnails-a-1x1-m"),window._taboola.push({mode:mode,container:tc.id,placement:placement,target_type:"mix"})}),window._taboola.push({flush:!0}),pkg.require(["mod.taboola"]))},PRIVATE.randomString=function(length){for(var result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",charactersLength=characters.length,counter=0;counter<length;)result+=characters.charAt(Math.floor(Math.random()*charactersLength)),counter+=1;return result},PRIVATE.isFullscreen=function(){return PRIVATE.elements.container.classList.contains("fullscreen")},function(){PRIVATE.id=data.id,PRIVATE.randomClass=PRIVATE.randomString(8);var oldGallery=document.querySelector("#gallery-starter-"+PRIVATE.id+":not([data-events])");oldGallery.classList.add(PRIVATE.randomClass),oldGallery.htmlDataset("alreadyRendered")?(PRIVATE.elements.container=oldGallery,PRIVATE.setUpEvents()):PRIVATE.getGalleryFeed()}(),PUBLIC},teardown:function(why,__static,__proto,__shared){}})});